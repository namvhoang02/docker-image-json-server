version: 2.1

# Define the jobs we want to run for this project
jobs:
  prepare:
    docker:
      - image: circleci/node:12.10.0
    steps:
      - checkout
      - run: echo "prepare job - skip for now"
  test:
    docker:
      - image: circleci/node:12.10.0
    steps:
      - checkout
      - run: echo "test job - skip for now"
  lint:
    docker:
      - image: circleci/node:12.10.0
    steps:
      - checkout
      - run: echo "lint job - skip for now"
  build:
    docker:
      - image: circleci/node:12.10.0
    steps:
      - checkout
      - run: echo "build job - skip for now"
  publish:
    machine: true
    steps:
      - checkout
      - run: |
          - docker login -u $DOCKER_HUB_USER -p $DOCKER_HUB_TOKEN
          - ls
      # Run a step to setup an environment variable
      # Redirect MY_ENV_VAR into $BASH_ENV
      - run:
          name: "Setup custom environment variables"
          command: echo 'export MY_ENV_VAR="FOO"' >> $BASH_ENV
      - run: # print the name of the branch we're on
          name: "What branch am I on?"
          command: echo ${CIRCLE_BRANCH}
      # Run another step, the same as above; note that you can
      # invoke environment variable without curly braces.
      - run:
          name: "What branch am I on now?"
          command: echo $CIRCLE_BRANCH
      - run:
          name: "What was my custom environment variable?"
          command: echo ${MY_ENV_VAR}
      - run:
          name: "Print an env var stored in the Project"
          command: echo ${PROJECT_ENV_VAR}
      - run:
          name: "Print an env var stored in a Context"
          command: echo ${CONTEXT_ENV_VAR}

# Orchestrate our job run sequence
workflows:
  build_and_test:
    jobs:
      - publish
